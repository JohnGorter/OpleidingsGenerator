<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-elements/paper-elements.html">
<link rel="import" href="../bower_components/iron-elements/iron-elements.html">
<link rel="import" href="shared-styles.html">
<link rel="import" href="../../elements/training-education-plan/training-education-plan.html">
<link rel="import" href="../../elements/training-education-plan-ajax/training-education-plan-ajax.html">
<link rel="import" href="../bower_components/app-route/app-route.html">

<dom-module id="educationplan-view">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
        padding: 10px;
      }
      
      .card {
        display: flex;
      }
      
      .card > div {
        margin: 10px;
      }
      
      .card > div:nth-child(1) {
        flex: 3;
      }
      
      .card > div:nth-child(2) {
        flex: 1;
      }

      paper-toast {
        cursor: pointer;
      }
    </style>

<app-route route="{{route}}" pattern="/:id" tail="{{subroute}}"></app-route>
<app-route route="{{subroute}}" pattern="/:id" data="{{routeData}}"></app-route>
<training-education-plan-ajax id="ajaxGETEducationPlan" auto education-plan-id="[[routeData.id]]" education-plan="{{educationPlan}}"></training-education-plan-ajax>

<iron-ajax id="ajaxDownloadEducationPlan" method="GET" handle-as="json" debounce-duration="500" content-type="application/json"
  on-response="_handleResponseDownload"></iron-ajax>

<div class="card">
  <div>
    <training-education-plan education-plan="{{educationPlan}}"></training-education-plan>
  </div>
  <div>
    <paper-button on-tap="_downloadEducationPlan" raised>Opleidingsplan downloaden</paper-button>
    <paper-button on-tap="_changeEducationPlan" raised>Opleidingsplan aanpassen</paper-button>
  </div>
</div>

</template>

<script>
  Polymer({
    is: 'educationplan-view',
    properties: {
      profile: String,
    },
    loadEducationPlanView: function () {
      if (!isNaN(parseInt(this.subroute.path.replace("/", "")))) {
        this.$.ajaxGETEducationPlan.generateRequest();
      }
    },
    _formatDate: function (dateAsString) {
      if (dateAsString == null) {
        return "-";
      }
      var date = new Date(dateAsString);
      return date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear();
    },
    handleResponse: function (educationPlan) {
      this.educationPlan = educationPlan.detail.response;
    },
    _changeEducationPlan: function (event) {
      this.set('route.path', 'educationplan-generator-view/' + this.routeData.id);
    },
    _downloadEducationPlan: function () {
      var downloadPath = "http://localhost:5123/api/GenerateWordFile/" + this.routeData.id;
      this.$.ajaxDownloadEducationPlan.url = downloadPath;
      this.$.ajaxDownloadEducationPlan.generateRequest();
    },
    _handleResponseDownload: function (response) {
      window.open("http://localhost:5123/Data/EducationPlanFiles/" + response.detail.response, '_blank', '');
    }
  });
</script>
</dom-module>